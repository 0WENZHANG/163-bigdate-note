## 从socket创建DataStream

- Java

```java
public class JavaDataStreamSourceApp {
    public static void main(String[] args) throws Exception {
        StreamExecutionEnvironment environment = StreamExecutionEnvironment.getExecutionEnvironment();
        socketFunction(environment);
        environment.execute("JavaDataStreamSourceApp");
    }

    public static void socketFunction(StreamExecutionEnvironment environment) {
        DataStreamSource<String> dataStreamSource = environment.socketTextStream("localhost", 9999);
        dataStreamSource.print().setParallelism(1);

    }
}
```

- Scala

    ```scala
    object ScalaDataStreamSourceApp {

        def socketFunction(environment: StreamExecutionEnvironment): Unit = {
            val data = environment.socketTextStream("localhost", 9999)
            data.print().setParallelism(1)

        }

        def main(args: Array[String]): Unit = {
            val environment = StreamExecutionEnvironment.getExecutionEnvironment
            socketFunction(environment);
            environment.execute("ScalaDataStreamSourceApp")
        }
    }
    ```

## Flink中使用数据源

1. 实现 SourceFunction，不能并行处理。

    - scala

        ```scala
        class CustomNonParallelSourceFunction extends SourceFunction[Long] {
            var count = 1L
            var isRunning = true
            
            override def run(ctx: SourceFunction.SourceContext[Long]): Unit = {
                while (isRunning) {
                    ctx.collect(count)
                    count += 1
                    Thread.sleep(1000)
                }
            }

            override def cancel(): Unit = {
                isRunning = false
            }
        }
        ```

        ```scala
        def nonParallelSourceFunction(environment: StreamExecutionEnvironment): Unit = {
            val data = environment.addSource(new CustomNonParallelSourceFunction).setParallelism(2)
            data.print().setParallelism(1)
        }

        def main(args: Array[String]): Unit = {
            val environment = StreamExecutionEnvironment.getExecutionEnvironment
            //socketFunction(environment);
            nonParallelSourceFunction(environment)
            environment.execute("ScalaDataStreamSourceApp")
        }
        ```



2. 实现 ParallelSourceFunction

    ```scala
    class CustomParallelSourceFunction extends ParallelSourceFunction[Long] {
        var isRunning = true
        var count = 1L

        override def run(ctx: SourceFunction.SourceContext[Long]): Unit = {
            while (isRunning) {
                ctx.collect(count)
                count += 1
                Thread.sleep(1000)
            }
        }

        override def cancel(): Unit = {
            isRunning = false
        }
    }
    ```

    ```scala
     def parallelSourceFunction(environment: StreamExecutionEnvironment): Unit = {
        val data = environment.addSource(new CustomParallelSourceFunction).setParallelism(2)
        data.print().setParallelism(1)
    }

    def main(args: Array[String]): Unit = {
        val environment = StreamExecutionEnvironment.getExecutionEnvironment
        //socketFunction(environment);
        //nonParallelSourceFunction(environment)
        parallelSourceFunction(environment)
        environment.execute("ScalaDataStreamSourceApp")
    }
    ```

3. 继承 RichParallelSourceFunction 